import{k as pe,l as _e,r as n,x as fe,o as he,b as h,c as g,d as B,e as l,h as u,t as C,f as q,i as b,g as V,y as be,v as L,j as O,n as ge,C as ye}from"./index-13be92d9.js";const xe={class:"grid p-fluid"},Ce={class:"field col-12 md:col-3"},Ve={class:"p-float-label"},Ne=l("label",{for:"paymentMethod"},"Payment methods",-1),Ie={class:"field col-12 md:col-3"},Se={class:"p-inputgroup"},qe={class:"p-float-label"},we=l("label",{for:"Customer"},"Select customer",-1),Te={class:"field col-12 md:col-3"},De={class:"p-float-label"},Ee=l("label",{for:"productId"},"Billing address",-1),ke={class:"field col-12 md:col-3"},Ue={class:"p-float-label"},Ae=l("label",{for:"date"},"Sales Date",-1),Be=l("div",{class:"col-12 md:col-3"},null,-1),Me=l("div",{class:"col-12 md:col-3"},null,-1),Re=l("div",{class:"col-12 md:col-3"},null,-1),Fe={class:"col-12 md:col-3"},Le={class:"font-bold text-right text-6xl green-color"},Oe={class:"col-12 md:col-12"},Pe={class:"card"},$e=["onClick"],ze=["onClick"],Xe=l("div",{class:"col-12 md:col-1"},null,-1),Qe={class:"col-12 md:col-1"},He=l("div",{class:"col-12 md:col-4"},null,-1),je=l("div",{class:"col-12 md:col-3"},null,-1),Ke={class:"col-12 md:col-3"},Je={class:"font-bold text-right text-xl green-color"},Ge=l("div",{class:"col-12 md:col-3"},null,-1),We={class:"col-12 md:col-3"},Ye={class:"p-float-label"},Ze=l("label",{for:"productId"},"Amount",-1),el={class:"col-12 md:col-3"},ll={key:0,class:"font-bold text-left text-xl green-color"},tl={class:"col-12 md:col-3"},ol={style:{"padding-top":"20px"}},al={class:"grid p-fluid"},sl={class:"field col-12 md:col-6"},nl={class:"p-float-label"},il=l("label",{for:"supplierName"},"Name",-1),ul={class:"field col-12 md:col-6"},dl={class:"p-float-label"},rl=l("label",{for:"supplierEmail"},"Email",-1),cl={class:"field col-12 md:col-6"},ml={class:"p-float-label"},vl=l("label",{for:"supplierAddress"},"Address",-1),pl={class:"field col-12 md:col-6"},_l={class:"p-float-label"},fl=l("label",{for:"supplierContact"},"Phone Number",-1),hl={class:"field col-12 md:col-12"},bl={class:"p-float-label"},gl=l("label",{for:"supplierDesc"},"More Info",-1),Cl={__name:"PointOfSale",setup(yl){const _=pe(),i=new ye,J=_e(),P=n(null),s=n([{id:null,price:null,quantity:null,discount:null,name:"",tax_config:null}]),f=n(0),v=n(0);n(0);const G=n({}),w=n({}),N=n(0),$=n(0),z=n(0),M=n(!1),T=n({}),y=n(null),D=n(null),E=n(null),k=n(null),U=n(null),X=n([]),Q=n([{id:1,name:"18%",amount:0,total:0},{id:2,name:"Exempted",amount:0,total:0}]),W=()=>{i.genericRequest("get-products","get",!0,{}).then(t=>{t.status?P.value=t.data:i.showError(_,t.message)})},Y=t=>{var c;console.log(JSON.stringify(t));let e={id:t.id,price:t.selling_price,quantity:1,discount:0,name:t.name,tax_config:t.tax_config};const o=s.value.find(r=>r.id===e.id);if(o)o.quantity+=e.quantity;else{let r=s.value.length-1;s.value.splice(r,0,e)}(c=w==null?void 0:w.value)!=null&&c.is_tax_enabled&&j()},Z=t=>{const e=s.value.findIndex(o=>o.id===t.id);e!==-1&&s.value.splice(e,1)},ee=(t,e)=>{s.value=s.value.map(o=>o.id===e.id?{...o,quantity:Number(t.target.value)}:o)},H=(t,e)=>{s.value=s.value.map(o=>{if(o.id===t.id){if(e=="Add")return{...o,quantity:Number(o.quantity+1)};if(o.quantity>0)return{...o,quantity:Number(o.quantity-1)}}return o}),j()},x=t=>{let e=0;return t.length>0&&t.forEach(o=>{e+=o.quantity*o.price}),e},le=()=>{var e;s.value=s==null?void 0:s.value.filter(o=>o.id!=null);let t={total:x(s==null?void 0:s.value)-Number(v==null?void 0:v.value)+Number(N.value),discount:Number(v==null?void 0:v.value),amountPaid:Number(f==null?void 0:f.value),itemCount:s==null?void 0:s.value.length,tranDate:F.value,items:s==null?void 0:s.value,status:"Active",vat:Number(N.value),vatInc:$.value,vatEx:z.value,payment_method:I==null?void 0:I.value.value,address:A.value,customer_id:(e=S==null?void 0:S.value)==null?void 0:e.id};i.genericRequest("create-order","post",!0,t).then(o=>{o.status?(i.showSuccess(_,o.message),i.redirect(J,"/view-sales")):i.showError(_,o.message)})},te=()=>{i.genericRequest("get-institution-details","get",!0,{}).then(t=>{t.status?w.value=t.data:i.showError(_,t.message)})},oe=()=>{G.value={global:{value:null,matchMode:be.CONTAINS}}},j=()=>{let t=0,e=0,o=0;s.value.forEach(m=>{const p=m.quantity*m.price;switch(m.tax_config){case"TAX_EXCLUSIVE":t+=p;break;case"TAX_INCLUSIVE":e+=p;break;case"TAX_EXEMPTED":o+=p;break}});const c=.18*t,r=.18*e;z.value=c,$.value=r,N.value=c,Q.value=Q.value.map(m=>m.id===1?{...m,total:c+r,amount:t+(e-r)}:m.id===2?{...m,total:0,amount:o}:m)},R=t=>{M.value=t},ae=(t,e)=>{T.value[e]=i.validateFormField(t)},se=()=>{if(T.value.customerName=i.validateFormField(y.value),i.validateRequiredFields(T.value)){i.showError(_,"Please fill in the missing field");return}let e={name:y.value,address:E.value,email:D.value,phone_number:k.value,description:U.value,status:"Active"};i.genericRequest("create-customer","post",!0,e).then(o=>{o.status?(i.showSuccess(_,o.message),K(),R(!1),y.value=null,E.value=null,D.value=null,k.value=null,U.value=null):i.showError(_,o.message)})},K=()=>{i.genericRequest("get-customers","post",!0,{}).then(t=>{t.status?X.value=t.data:i.showError(_,t.message)})},ne=t=>{t.value.address&&(A.value=t.value.address)},ie=n([]),I=n({id:1,name:"Cash",value:"CASH"}),A=n(null),S=n(null),F=n(new Date);n(0),n(0);const ue=n([{id:1,name:"Cash",value:"CASH"},{id:2,name:"Bank",value:"BANK"},{id:3,name:"Credit",value:"CREDIT"}]),de=()=>[{id:null,name:"",description:"",quantity:null,rate:null,amount:null,uuid:i.generateUUID()},{id:null,name:"",description:"",quantity:null,rate:null,amount:null,uuid:i.generateUUID()},{id:null,name:"",description:"",quantity:null,rate:null,amount:null,uuid:i.generateUUID()},{id:null,name:"",description:"",quantity:null,rate:null,amount:null,uuid:i.generateUUID()},{id:null,name:"",description:"",quantity:null,rate:null,amount:null,uuid:i.generateUUID()}];n([{field:"name",header:"Product/Services"},{field:"description",header:"Description"},{field:"quantity",header:"Quantity"},{field:"rate",header:"Rate"},{field:"amount",header:"Amount"},{field:"tax",header:"Tax"}]);const re=()=>{s.value=[{id:null,price:null,quantity:null,discount:null,name:"",tax_config:null}]};return fe(()=>{oe()}),he(()=>{W(),te(),K(),ie.value=de()}),(t,e)=>{const o=h("Dropdown"),c=h("Button"),r=h("InputText"),m=h("Calendar"),p=h("Column"),ce=h("DataTable"),me=h("Textarea"),ve=h("Dialog");return g(),B("div",xe,[l("div",Ce,[l("span",Ve,[u(o,{id:"paymentMethod",options:ue.value,filter:"",modelValue:I.value,"onUpdate:modelValue":e[0]||(e[0]=a=>I.value=a),optionLabel:"name"},null,8,["options","modelValue"]),Ne])]),l("div",Ie,[l("div",Se,[l("span",qe,[u(o,{id:"customer",onChange:ne,options:X.value,filter:"",modelValue:S.value,"onUpdate:modelValue":e[1]||(e[1]=a=>S.value=a),optionLabel:"name"},null,8,["options","modelValue"]),we]),u(c,{onClick:e[2]||(e[2]=a=>R(!0)),icon:"pi pi-plus"})])]),l("div",Te,[l("span",De,[u(r,{type:"text",id:"productId",modelValue:A.value,"onUpdate:modelValue":e[3]||(e[3]=a=>A.value=a)},null,8,["modelValue"]),Ee])]),l("div",ke,[l("span",Ue,[u(m,{id:"date",modelValue:F.value,"onUpdate:modelValue":e[4]||(e[4]=a=>F.value=a)},null,8,["modelValue"]),Ae])]),Be,Me,Re,l("div",Fe,[l("p",Le,"Total: "+C(x(s.value)?q(i).commaSeparator(x(s.value)-Number(v.value)+Number(N.value)):0),1)]),l("div",Oe,[l("div",Pe,[u(ce,{value:s.value,size:"small",rows:20,dataKey:"id",rowHover:!0,filterDisplay:"menu",responsiveLayout:"scroll"},{default:b(()=>[u(p,{field:"name",header:"Name",style:{"max-width":"10rem"}},{body:b(({data:a})=>[a.id?V("",!0):(g(),L(o,{key:0,id:"subCategory",change:"",options:P.value,filter:"",optionLabel:"name",onChange:e[5]||(e[5]=d=>Y(d.value))},null,8,["options"])),O(" "+C(a.name),1)]),_:1}),u(p,{field:"price",header:"Price",style:{"max-width":"10rem"}},{body:b(({data:a})=>[O(C(q(i).commaSeparator(a.price)),1)]),_:1}),u(p,{field:"quantity",header:"Qty",style:{"min-width":"10rem"}},{body:b(({data:a})=>[a.id?(g(),B("i",{key:0,class:"pi pi-minus",onClick:d=>H(a,"Subtract"),style:{"font-size":"1rem","margin-left":"3px",cursor:"pointer"}},null,8,$e)):V("",!0),a.id?(g(),L(r,{key:1,type:"text",onChange:d=>ee(d,a),value:a.quantity,style:{width:"60px",padding:"5px","margin-left":"1px","margin-right":"1px","text-align":"center"},placeholder:"Qty"},null,8,["onChange","value"])):V("",!0),a.id?(g(),B("i",{key:2,class:"pi pi-plus",onClick:d=>H(a,"Add"),style:{"font-size":"1rem","margin-right":"3px",cursor:"pointer"}},null,8,ze)):V("",!0)]),_:1}),u(p,{field:"subtotal",header:"Sub Total",style:{"max-width":"10rem"}},{body:b(({data:a})=>[O(C(a.id?q(i).commaSeparator(a.quantity*a.price):""),1)]),_:1}),u(p,{headerStyle:"max-width:10rem;"},{body:b(({data:a})=>[a.id?(g(),L(c,{key:0,icon:"pi pi-trash",class:"p-button-rounded p-button-danger mr-2",onClick:d=>Z(a)},null,8,["onClick"])):V("",!0)]),_:1})]),_:1},8,["value"])])]),Xe,l("div",Qe,[u(c,{label:"Clear",onClick:re,icon:"pi pi-minus",iconPos:"left",class:"p-button-danger mr-2 mb-2"})]),He,je,l("div",Ke,[l("p",Je,"Total: "+C(x(s.value)?q(i).commaSeparator(x(s.value)-Number(v.value)+Number(N.value)):0),1)]),Ge,l("div",We,[l("span",Ye,[u(r,{type:"text",id:"discount",modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=a=>f.value=a)},null,8,["modelValue"]),Ze])]),l("div",el,[f.value&&f.value>0?(g(),B("p",ll,"Change: "+C(q(i).commaSeparator(Number(f.value)+Number(v.value)-x(s.value))),1)):V("",!0)]),l("div",tl,[u(c,{onClick:le,label:"SUBMIT",class:"p-button-outlined mr-2 mb-2"})]),u(ve,{header:"Create new customer",visible:M.value,"onUpdate:visible":e[14]||(e[14]=a=>M.value=a),style:{width:"75vw"},modal:!0,class:"p-fluid"},{footer:b(()=>[u(c,{label:"Cancel",onClick:e[13]||(e[13]=a=>R(!1)),icon:"pi pi-times",class:"p-button-outlined p-button-danger mr-2 mb-2"}),u(c,{onClick:se,label:"SUBMIT",class:"p-button-outlined mr-2 mb-2"})]),default:b(()=>{var a;return[l("p",ol,[l("div",al,[l("div",sl,[l("span",nl,[u(r,{type:"text",id:"customerName",onBlur:e[7]||(e[7]=d=>ae(y.value,"customerName")),modelValue:y.value,"onUpdate:modelValue":e[8]||(e[8]=d=>y.value=d),class:ge({"p-invalid":(a=T.value)==null?void 0:a.customerName})},null,8,["modelValue","class"]),il])]),l("div",ul,[l("span",dl,[u(r,{type:"text",id:"supplierEmail",modelValue:D.value,"onUpdate:modelValue":e[9]||(e[9]=d=>D.value=d)},null,8,["modelValue"]),rl])]),l("div",cl,[l("span",ml,[u(r,{type:"text",id:"supplierAddress",modelValue:E.value,"onUpdate:modelValue":e[10]||(e[10]=d=>E.value=d)},null,8,["modelValue"]),vl])]),l("div",pl,[l("span",_l,[u(r,{type:"text",id:"supplierContact",modelValue:k.value,"onUpdate:modelValue":e[11]||(e[11]=d=>k.value=d)},null,8,["modelValue"]),fl])]),l("div",hl,[l("span",bl,[u(me,{inputId:"supplierDesc",rows:"7",modelValue:U.value,"onUpdate:modelValue":e[12]||(e[12]=d=>U.value=d)},null,8,["modelValue"]),gl])])])])]}),_:1},8,["visible"])])}}};export{Cl as default};
