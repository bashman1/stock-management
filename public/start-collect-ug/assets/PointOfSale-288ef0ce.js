import{k as $,l as j,r as _,x as H,o as K,b as T,p as F,c as k,d as N,e,h as s,i as c,g as V,t as u,f,y as G,j as m,q as J,C as W}from"./index-21ca65f0.js";const Y={class:"grid p-fluid"},Z={class:"col-12 md:col-7"},ee={class:"card"},te=e("h5",null,"Point Of Sale",-1),le=e("br",null,null,-1),ae={class:"grid"},oe={class:"col-12 md:col-12"},se=e("p",null,"Items available in the stock.",-1),ie={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},ne={class:"block mt-2 md:mt-0 p-input-icon-left"},ce=e("i",{class:"pi pi-search"},null,-1),de={class:"col-12 md:col-5"},ue={class:"card"},re=e("h5",null,"Selected Items",-1),me=e("br",null,null,-1),_e={class:"grid"},ve={class:"field col-12 md:col-12"},he=["onClick"],pe=["onClick"],fe={key:0,class:"card"},ye=e("h5",null,"V.A.T 18%",-1),be=e("br",null,null,-1),ge={class:"grid"},xe={class:"field col-12 md:col-12"},we={class:"card"},Se=e("h5",null,"Total ",-1),Ce=e("br",null,null,-1),Te={class:"grid"},ke=e("div",{class:"field col-12 md:col-4"},[e("span",{class:"p-float-label"}," Amount To Pay ")],-1),Ne={class:"field col-12 md:col-8"},qe={class:"p-float-label"},Ve=e("div",{class:"field col-12 md:col-4"},[e("span",{class:"p-float-label"}," Discount ")],-1),Ie={class:"field col-12 md:col-8"},Ee={class:"p-float-label"},Ae=e("label",{for:"discount"},"Discount Amount",-1),De=e("div",{class:"field col-12 md:col-4"},[e("span",{class:"p-float-label"}," Amount Paid ")],-1),Me={class:"field col-12 md:col-8"},Be={class:"p-float-label"},Pe=e("label",{for:"discount"},"Amount",-1),Le=e("div",{class:"field col-12 md:col-4"},[e("span",{class:"p-float-label"}," Change ")],-1),Re={class:"field col-12 md:col-8"},Ue={key:0,class:"p-float-label"},ze={key:1,class:"p-float-label"},Oe=e("div",{class:"field col-12 md:col-8"},null,-1),Xe={class:"field col-12 md:col-4"},je={__name:"PointOfSale",setup(Qe){const x=$(),d=new W,P=j(),I=_(null),i=_([]),v=_(0),h=_(0);_(0);const w=_({}),y=_({}),S=_(0),E=_(0),A=_(0),q=_([{id:1,name:"18%",amount:0,total:0},{id:2,name:"Exempted",amount:0,total:0}]),L=()=>{d.genericRequest("get-products","get",!0,{}).then(l=>{l.status?I.value=l.data:d.showError(x,l.message)})},R=l=>{var n;let a={id:l.id,price:l.selling_price,quantity:1,discount:0,name:l.name,tax_config:l.tax_config};const o=i.value.find(p=>p.id===a.id);o?o.quantity+=a.quantity:i.value.push(a),(n=y==null?void 0:y.value)!=null&&n.is_tax_enabled&&M()},U=l=>{const a=i.value.findIndex(o=>o.id===l.id);a!==-1&&i.value.splice(a,1)},z=(l,a)=>{i.value=i.value.map(o=>o.id===a.id?{...o,quantity:Number(l.target.value)}:o)},D=(l,a)=>{i.value=i.value.map(o=>{if(o.id===l.id){if(a=="Add")return{...o,quantity:Number(o.quantity+1)};if(o.quantity>0)return{...o,quantity:Number(o.quantity-1)}}return o}),M()},C=l=>{let a=0;return l.length>0&&l.forEach(o=>{a+=o.quantity*o.price}),a},O=()=>{let l={total:C(i==null?void 0:i.value)-Number(h==null?void 0:h.value)+Number(S.value),discount:Number(h==null?void 0:h.value),amountPaid:Number(v==null?void 0:v.value),itemCount:i==null?void 0:i.value.length,tranDate:new Date,items:i==null?void 0:i.value,status:"Active",vat:Number(S.value),vatInc:E.value,vatEx:A.value};d.genericRequest("create-order","post",!0,l).then(a=>{a.status?(d.showSuccess(x,a.message),d.redirect(P,"/view-sales")):d.showError(x,a.message)})},X=()=>{d.genericRequest("get-institution-details","get",!0,{}).then(l=>{l.status?y.value=l.data:d.showError(x,l.message)})},Q=()=>{w.value={global:{value:null,matchMode:G.CONTAINS}}},M=()=>{let l=0,a=0,o=0;i.value.forEach(r=>{const b=r.quantity*r.price;switch(r.tax_config){case"TAX_EXCLUSIVE":l+=b;break;case"TAX_INCLUSIVE":a+=b;break;case"TAX_EXEMPTED":o+=b;break}});const n=.18*l,p=.18*a;A.value=n,E.value=p,S.value=n,q.value=q.value.map(r=>r.id===1?{...r,total:n+p,amount:l+(a-p)}:r.id===2?{...r,total:0,amount:o}:r)};return H(()=>{Q()}),K(()=>{L(),X()}),(l,a)=>{var B;const o=T("InputText"),n=T("Column"),p=T("Button"),r=T("DataTable"),b=F("tooltip");return k(),N("div",Y,[e("div",Z,[e("div",ee,[te,le,e("div",ae,[e("div",oe,[se,s(r,{value:I.value,paginator:!0,size:"small",class:"p-datatable-gridlines",rows:50,dataKey:"id",filters:w.value,rowHover:!0,filterDisplay:"menu",responsiveLayout:"scroll"},{header:c(()=>[e("div",ie,[e("span",ne,[ce,s(o,{modelValue:w.value.global.value,"onUpdate:modelValue":a[0]||(a[0]=t=>w.value.global.value=t),placeholder:"Search..."},null,8,["modelValue"])])])]),default:c(()=>[s(n,{field:"name",header:"Product",style:{"min-width":"10rem"}},{body:c(({data:t})=>[m(u(t.name),1)]),_:1}),s(n,{field:"name",header:"Category",style:{"min-width":"10rem"}},{body:c(({data:t})=>[m(u(t.category_name),1)]),_:1}),s(n,{field:"name",header:"Price",style:{"max-width":"10rem"}},{body:c(({data:t})=>[m(u(f(d).commaSeparator(t.selling_price)),1)]),_:1}),s(n,{field:"name",header:"Quantity",style:{"max-width":"15rem"}},{body:c(({data:t})=>[m(u(t.quantity+" "+t.unit),1)]),_:1}),s(n,{header:"Manufacturer",style:{"min-width":"10rem"}},{body:c(({data:t})=>[m(u(t.manufacturer),1)]),_:1}),s(n,{header:"Date",style:{"min-width":"10rem"}},{body:c(({data:t})=>[m(u(t.created_at),1)]),_:1}),s(n,{headerStyle:"max-width:10rem;"},{body:c(({data:t})=>[J(s(p,{icon:"pi pi-check",class:"p-button-success mr-2",onClick:g=>R(t)},null,8,["onClick"]),[[b,"Select product"]])]),_:1})]),_:1},8,["value","filters"])])])])]),e("div",de,[e("div",ue,[re,me,e("div",_e,[e("div",ve,[s(r,{value:i.value,size:"small",rows:20,dataKey:"id",rowHover:!0,filterDisplay:"menu",responsiveLayout:"scroll"},{default:c(()=>[s(n,{field:"name",header:"Name",style:{"max-width":"10rem"}},{body:c(({data:t})=>[m(u(t.name),1)]),_:1}),s(n,{field:"price",header:"Price",style:{"max-width":"10rem"}},{body:c(({data:t})=>[m(u(f(d).commaSeparator(t.price)),1)]),_:1}),s(n,{field:"quantity",header:"Qty",style:{"min-width":"10rem"}},{body:c(({data:t})=>[e("i",{class:"pi pi-minus",onClick:g=>D(t,"Subtract"),style:{"font-size":"1rem","margin-left":"3px",cursor:"pointer"}},null,8,he),s(o,{type:"text",onChange:g=>z(g,t),value:t.quantity,style:{width:"60px",padding:"5px","margin-left":"1px","margin-right":"1px","text-align":"center"},placeholder:"Qty"},null,8,["onChange","value"]),e("i",{class:"pi pi-plus",onClick:g=>D(t,"Add"),style:{"font-size":"1rem","margin-right":"3px",cursor:"pointer"}},null,8,pe)]),_:1}),s(n,{field:"subtotal",header:"Sub Total",style:{"max-width":"10rem"}},{body:c(({data:t})=>[m(u(f(d).commaSeparator(t.quantity*t.price)),1)]),_:1}),s(n,{headerStyle:"max-width:10rem;"},{body:c(({data:t})=>[s(p,{icon:"pi pi-trash",class:"p-button-rounded p-button-danger mr-2",onClick:g=>U(t)},null,8,["onClick"])]),_:1})]),_:1},8,["value"])])])]),(B=y.value)!=null&&B.is_tax_enabled&&i.value.length>0?(k(),N("div",fe,[ye,be,e("div",ge,[e("div",xe,[s(r,{value:q.value,size:"small",rows:20,dataKey:"id",rowHover:!0,filterDisplay:"menu",responsiveLayout:"scroll"},{default:c(()=>[s(n,{field:"name",header:"18%",style:{"max-width":"10rem"}},{body:c(({data:t})=>[m(u(t.name),1)]),_:1}),s(n,{field:"price",header:"Amount",style:{"max-width":"10rem"}},{body:c(({data:t})=>[m(u(f(d).commaSeparator(t.amount)),1)]),_:1}),s(n,{field:"subtotal",header:"V.A.T",style:{"max-width":"10rem"}},{body:c(({data:t})=>[m(u(f(d).commaSeparator(t.total)),1)]),_:1})]),_:1},8,["value"])])])])):V("",!0),e("div",we,[Se,Ce,e("div",Te,[ke,e("div",Ne,[e("span",qe,u(C(i.value)?f(d).commaSeparator(C(i.value)-Number(h.value)+Number(S.value)):0),1)]),Ve,e("div",Ie,[e("span",Ee,[s(o,{type:"text",id:"discount",modelValue:h.value,"onUpdate:modelValue":a[1]||(a[1]=t=>h.value=t)},null,8,["modelValue"]),Ae])]),De,e("div",Me,[e("span",Be,[s(o,{type:"text",id:"discount",modelValue:v.value,"onUpdate:modelValue":a[2]||(a[2]=t=>v.value=t)},null,8,["modelValue"]),Pe])]),Le,e("div",Re,[v.value&&v.value>0?(k(),N("span",Ue,u(f(d).commaSeparator(Number(v.value)+Number(h.value)-C(i.value))),1)):V("",!0),!v.value||v.value==0?(k(),N("span",ze,"0")):V("",!0)]),Oe,e("div",Xe,[s(p,{onClick:O,label:"SUBMIT",class:"p-button-outlined mr-2 mb-2"})])])])])])}}};export{je as default};
