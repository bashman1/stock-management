import{l as O,m as X,r as v,v as Q,o as $,b as C,c as T,d as k,e,h as s,i as c,g as q,t as u,f,x as H,k as m,C as K}from"./index-176c0cd2.js";const j={class:"grid p-fluid"},F={class:"col-12 md:col-7"},G={class:"card"},J=e("h5",null,"Point Of Sale",-1),W=e("br",null,null,-1),Y={class:"grid"},Z={class:"col-12 md:col-12"},ee=e("p",null,"Items available in the stock.",-1),te={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},le={class:"block mt-2 md:mt-0 p-input-icon-left"},ae=e("i",{class:"pi pi-search"},null,-1),oe={class:"col-12 md:col-5"},se={class:"card"},ne=e("h5",null,"Selected Items",-1),ie=e("br",null,null,-1),ce={class:"grid"},de={class:"field col-12 md:col-12"},ue=["onClick"],re=["onClick"],me={key:0,class:"card"},_e=e("h5",null,"V.A.T 18%",-1),he=e("br",null,null,-1),ve={class:"grid"},pe={class:"field col-12 md:col-12"},fe={class:"card"},ye=e("h5",null,"Total ",-1),be=e("br",null,null,-1),ge={class:"grid"},xe=e("div",{class:"field col-12 md:col-4"},[e("span",{class:"p-float-label"}," Amount To Pay ")],-1),we={class:"field col-12 md:col-8"},Se={class:"p-float-label"},Ce=e("div",{class:"field col-12 md:col-4"},[e("span",{class:"p-float-label"}," Discount ")],-1),Te={class:"field col-12 md:col-8"},ke={class:"p-float-label"},Ve=e("label",{for:"discount"},"Discount Amount",-1),qe=e("div",{class:"field col-12 md:col-4"},[e("span",{class:"p-float-label"}," Amount Paid ")],-1),Ne={class:"field col-12 md:col-8"},Ae={class:"p-float-label"},Ie=e("label",{for:"discount"},"Amount",-1),Ee=e("div",{class:"field col-12 md:col-4"},[e("span",{class:"p-float-label"}," Change ")],-1),De={class:"field col-12 md:col-8"},Me={key:0,class:"p-float-label"},Be={key:1,class:"p-float-label"},Pe=e("div",{class:"field col-12 md:col-8"},null,-1),Le={class:"field col-12 md:col-4"},ze={__name:"PointOfSale",setup(Re){const x=O(),d=new K,E=X(),N=v(null),n=v([]),_=v(0),h=v(0);v(0);const w=v({}),b=v({}),A=v(0),V=v([{id:1,name:"18%",amount:0,total:0},{id:2,name:"Exempted",amount:0,total:0}]),D=()=>{d.genericRequest("get-products","get",!0,{}).then(l=>{l.status?N.value=l.data:d.showError(x,l.message)})},M=l=>{var i;let a={id:l.id,price:l.selling_price,quantity:1,discount:0,name:l.name,tax_config:l.tax_config};const o=n.value.find(p=>p.id===a.id);o?o.quantity+=a.quantity:n.value.push(a),(i=b==null?void 0:b.value)!=null&&i.is_tax_enabled&&z()},B=l=>{const a=n.value.findIndex(o=>o.id===l.id);a!==-1&&n.value.splice(a,1)},P=(l,a)=>{n.value=n.value.map(o=>o.id===a.id?{...o,quantity:Number(l.target.value)}:o)},I=(l,a)=>{n.value=n.value.map(o=>{if(o.id===l.id){if(a=="Add")return{...o,quantity:Number(o.quantity+1)};if(o.quantity>0)return{...o,quantity:Number(o.quantity-1)}}return o})},S=l=>{let a=0;return l.length>0&&l.forEach(o=>{a+=o.quantity*o.price}),a},L=()=>{let l={total:S(n==null?void 0:n.value)-Number(h==null?void 0:h.value),discount:Number(h==null?void 0:h.value),amountPaid:Number(_==null?void 0:_.value),itemCount:n==null?void 0:n.value.length,tranDate:new Date,items:n==null?void 0:n.value,status:"Active"};d.genericRequest("create-order","post",!0,l).then(a=>{a.status?(d.showSuccess(x,a.message),d.redirect(E,"/view-sales")):d.showError(x,a.message)})},R=()=>{d.genericRequest("get-institution-details","get",!0,{}).then(l=>{l.status?b.value=l.data:d.showError(x,l.message)})},U=()=>{w.value={global:{value:null,matchMode:H.CONTAINS}}},z=()=>{let l=0,a=0,o=0;n.value.forEach(r=>{const y=r.quantity*r.price;switch(r.tax_config){case"TAX_EXCLUSIVE":l+=y;break;case"TAX_INCLUSIVE":a+=y;break;case"TAX_EXEMPTED":o+=y;break}});const i=.18*l,p=.18*a;A.value=i,V.value=V.value.map(r=>r.id===1?{...r,total:i+p,amount:l+(a-p)}:r.id===2?{...r,total:0,amount:o}:r)};return Q(()=>{U()}),$(()=>{D(),R()}),(l,a)=>{var y;const o=C("InputText"),i=C("Column"),p=C("Button"),r=C("DataTable");return T(),k("div",j,[e("div",F,[e("div",G,[J,W,e("div",Y,[e("div",Z,[ee,s(r,{value:N.value,paginator:!0,size:"small",class:"p-datatable-gridlines",rows:50,dataKey:"id",filters:w.value,rowHover:!0,filterDisplay:"menu",responsiveLayout:"scroll"},{header:c(()=>[e("div",te,[e("span",le,[ae,s(o,{modelValue:w.value.global.value,"onUpdate:modelValue":a[0]||(a[0]=t=>w.value.global.value=t),placeholder:"Search..."},null,8,["modelValue"])])])]),default:c(()=>[s(i,{field:"name",header:"Product",style:{"min-width":"10rem"}},{body:c(({data:t})=>[m(u(t.name),1)]),_:1}),s(i,{field:"name",header:"Category",style:{"min-width":"10rem"}},{body:c(({data:t})=>[m(u(t.category_name),1)]),_:1}),s(i,{field:"name",header:"Price",style:{"max-width":"10rem"}},{body:c(({data:t})=>[m(u(f(d).commaSeparator(t.selling_price)),1)]),_:1}),s(i,{field:"name",header:"Quantity",style:{"max-width":"15rem"}},{body:c(({data:t})=>[m(u(t.quantity+" "+t.unit),1)]),_:1}),s(i,{header:"Manufacturer",style:{"min-width":"10rem"}},{body:c(({data:t})=>[m(u(t.manufacturer),1)]),_:1}),s(i,{header:"Date",style:{"min-width":"10rem"}},{body:c(({data:t})=>[m(u(t.created_at),1)]),_:1}),s(i,{headerStyle:"max-width:10rem;"},{body:c(({data:t})=>[s(p,{icon:"pi pi-check",class:"p-button-rounded p-button-success mr-2",onClick:g=>M(t)},null,8,["onClick"])]),_:1})]),_:1},8,["value","filters"])])])])]),e("div",oe,[e("div",se,[ne,ie,e("div",ce,[e("div",de,[s(r,{value:n.value,size:"small",rows:20,dataKey:"id",rowHover:!0,filterDisplay:"menu",responsiveLayout:"scroll"},{default:c(()=>[s(i,{field:"name",header:"Name",style:{"max-width":"10rem"}},{body:c(({data:t})=>[m(u(t.name),1)]),_:1}),s(i,{field:"price",header:"Price",style:{"max-width":"10rem"}},{body:c(({data:t})=>[m(u(f(d).commaSeparator(t.price)),1)]),_:1}),s(i,{field:"quantity",header:"Qty",style:{"min-width":"10rem"}},{body:c(({data:t})=>[e("i",{class:"pi pi-minus",onClick:g=>I(t,"Subtract"),style:{"font-size":"1rem","margin-left":"3px",cursor:"pointer"}},null,8,ue),s(o,{type:"text",onChange:g=>P(g,t),value:t.quantity,style:{width:"60px",padding:"5px","margin-left":"1px","margin-right":"1px","text-align":"center"},placeholder:"Qty"},null,8,["onChange","value"]),e("i",{class:"pi pi-plus",onClick:g=>I(t,"Add"),style:{"font-size":"1rem","margin-right":"3px",cursor:"pointer"}},null,8,re)]),_:1}),s(i,{field:"subtotal",header:"Sub Total",style:{"max-width":"10rem"}},{body:c(({data:t})=>[m(u(f(d).commaSeparator(t.quantity*t.price)),1)]),_:1}),s(i,{headerStyle:"max-width:10rem;"},{body:c(({data:t})=>[s(p,{icon:"pi pi-trash",class:"p-button-rounded p-button-danger mr-2",onClick:g=>B(t)},null,8,["onClick"])]),_:1})]),_:1},8,["value"])])])]),(y=b.value)!=null&&y.is_tax_enabled&&n.value.length>0?(T(),k("div",me,[_e,he,e("div",ve,[e("div",pe,[s(r,{value:V.value,size:"small",rows:20,dataKey:"id",rowHover:!0,filterDisplay:"menu",responsiveLayout:"scroll"},{default:c(()=>[s(i,{field:"name",header:"18%",style:{"max-width":"10rem"}},{body:c(({data:t})=>[m(u(t.name),1)]),_:1}),s(i,{field:"price",header:"Amount",style:{"max-width":"10rem"}},{body:c(({data:t})=>[m(u(f(d).commaSeparator(t.amount)),1)]),_:1}),s(i,{field:"subtotal",header:"V.A.T",style:{"max-width":"10rem"}},{body:c(({data:t})=>[m(u(f(d).commaSeparator(t.total)),1)]),_:1})]),_:1},8,["value"])])])])):q("",!0),e("div",fe,[ye,be,e("div",ge,[xe,e("div",we,[e("span",Se,u(S(n.value)?f(d).commaSeparator(S(n.value)-Number(h.value)+Number(A.value)):0),1)]),Ce,e("div",Te,[e("span",ke,[s(o,{type:"text",id:"discount",modelValue:h.value,"onUpdate:modelValue":a[1]||(a[1]=t=>h.value=t)},null,8,["modelValue"]),Ve])]),qe,e("div",Ne,[e("span",Ae,[s(o,{type:"text",id:"discount",modelValue:_.value,"onUpdate:modelValue":a[2]||(a[2]=t=>_.value=t)},null,8,["modelValue"]),Ie])]),Ee,e("div",De,[_.value&&_.value>0?(T(),k("span",Me,u(f(d).commaSeparator(Number(_.value)+Number(h.value)-S(n.value))),1)):q("",!0),!_.value||_.value==0?(T(),k("span",Be,"0")):q("",!0)]),Pe,e("div",Le,[s(p,{onClick:L,label:"SUBMIT",class:"p-button-outlined mr-2 mb-2"})])])])])])}}};export{ze as default};
