import{k as fe,l as be,r as c,x as ye,o as ge,b as C,p as xe,c as x,d as U,e,h as s,t as r,i as d,g as O,f as w,y as Ce,F as we,s as Ve,v as M,j as _,q as Ie,C as Se}from"./index-c8fc0eb0.js";const ke={class:"grid p-fluid"},Ue={class:"field col-12 md:col-3"},De={class:"p-inputgroup"},qe={class:"p-float-label"},Te=e("label",{for:"paymentMethod"},"Payment methods",-1),Ne={class:"field col-12 md:col-3"},Ee={class:"p-inputgroup"},Ae={class:"p-float-label"},Me=e("label",{for:"Customer"},"Select customer",-1),Pe={class:"field col-12 md:col-3"},Be={class:"p-float-label"},Le=e("label",{for:"productId"},"Billing address",-1),Re={class:"field col-12 md:col-3"},Oe={class:"p-float-label"},$e=e("label",{for:"date"},"Sales Date",-1),ze=e("div",{class:"col-12 md:col-3"},null,-1),Fe=e("div",{class:"col-12 md:col-3"},null,-1),Qe=e("div",{class:"col-12 md:col-3"},null,-1),Xe={class:"col-12 md:col-3"},Ge={class:"font-bold text-right text-6xl green-color"},je={class:"col-12 md:col-12"},He={class:"card"},Ke={class:"col-12 md:col-1"},Je={class:"col-12 md:col-1"},We=e("div",{class:"col-12 md:col-4"},null,-1),Ye=e("div",{class:"col-12 md:col-3"},null,-1),Ze={class:"col-12 md:col-3"},el={class:"font-bold text-right text-xl green-color"},ll=e("div",{class:"col-12 md:col-3"},null,-1),tl={class:"col-12 md:col-3"},ol={class:"p-float-label"},al=e("label",{for:"productId"},"Amount",-1),sl={class:"col-12 md:col-3"},nl={class:"font-bold text-left text-xl green-color"},il={class:"col-12 md:col-3"},dl={class:"col-12 md:col-7"},ul={class:"card"},cl=e("h5",null,"Point Of Sale",-1),rl=e("br",null,null,-1),ml={class:"grid"},pl={class:"col-12 md:col-12"},_l=e("p",null,"Items available in the stock.",-1),vl={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},hl={class:"block mt-2 md:mt-0 p-input-icon-left"},fl=e("i",{class:"pi pi-search"},null,-1),bl={class:"col-12 md:col-5"},yl={class:"card"},gl=e("h5",null,"Selected Items",-1),xl=e("br",null,null,-1),Cl={class:"grid"},wl={class:"field col-12 md:col-12"},Vl=["onClick"],Il=["onClick"],Sl={key:0,class:"card"},kl=e("h5",null,"V.A.T 18%",-1),Ul=e("br",null,null,-1),Dl={class:"grid"},ql={class:"field col-12 md:col-12"},Tl={class:"card"},Nl=e("h5",null,"Total ",-1),El=e("br",null,null,-1),Al={class:"grid"},Ml=e("div",{class:"field col-12 md:col-4"},[e("span",{class:"p-float-label green-color"}," Amount To Pay ")],-1),Pl={class:"field col-12 md:col-8"},Bl={class:"p-float-label green-color"},Ll=e("div",{class:"field col-12 md:col-4"},[e("span",{class:"p-float-label green-color"}," Discount ")],-1),Rl={class:"field col-12 md:col-8"},Ol={class:"p-float-label"},$l=e("label",{for:"discount"},"Discount Amount",-1),zl=e("div",{class:"field col-12 md:col-4"},[e("span",{class:"p-float-label green-color"}," Amount Paid ")],-1),Fl={class:"field col-12 md:col-8"},Ql={class:"p-float-label"},Xl=e("label",{for:"discount"},"Amount",-1),Gl=e("div",{class:"field col-12 md:col-4"},[e("span",{class:"p-float-label green-color"}," Change ")],-1),jl={class:"field col-12 md:col-8"},Hl={key:0,class:"p-float-label green-color"},Kl={key:1,class:"p-float-label"},Jl=e("div",{class:"field col-12 md:col-8"},null,-1),Wl={class:"field col-12 md:col-4"},et={__name:"PointOfSale",setup(Yl){const D=fe(),u=new Se,W=be(),P=c(null),i=c([]),y=c(0),g=c(0);c(0);const q=c({}),S=c({}),T=c(0),$=c(0),z=c(0),B=c([{id:1,name:"18%",amount:0,total:0},{id:2,name:"Exempted",amount:0,total:0}]),Y=()=>{u.genericRequest("get-products","get",!0,{}).then(o=>{o.status?P.value=o.data:u.showError(D,o.message)})},Z=o=>{var n;let l={id:o.id,price:o.selling_price,quantity:1,discount:0,name:o.name,tax_config:o.tax_config};const a=i.value.find(p=>p.id===l.id);a?a.quantity+=l.quantity:i.value.push(l),(n=S==null?void 0:S.value)!=null&&n.is_tax_enabled&&Q()},ee=o=>{const l=i.value.findIndex(a=>a.id===o.id);l!==-1&&i.value.splice(l,1)},le=(o,l)=>{i.value=i.value.map(a=>a.id===l.id?{...a,quantity:Number(o.target.value)}:a)},F=(o,l)=>{i.value=i.value.map(a=>{if(a.id===o.id){if(l=="Add")return{...a,quantity:Number(a.quantity+1)};if(a.quantity>0)return{...a,quantity:Number(a.quantity-1)}}return a}),Q()},N=o=>{let l=0;return o.length>0&&o.forEach(a=>{l+=a.quantity*a.price}),l},te=()=>{let o={total:N(i==null?void 0:i.value)-Number(g==null?void 0:g.value)+Number(T.value),discount:Number(g==null?void 0:g.value),amountPaid:Number(y==null?void 0:y.value),itemCount:i==null?void 0:i.value.length,tranDate:new Date,items:i==null?void 0:i.value,status:"Active",vat:Number(T.value),vatInc:$.value,vatEx:z.value};u.genericRequest("create-order","post",!0,o).then(l=>{l.status?(u.showSuccess(D,l.message),u.redirect(W,"/view-sales")):u.showError(D,l.message)})},oe=()=>{u.genericRequest("get-institution-details","get",!0,{}).then(o=>{o.status?S.value=o.data:u.showError(D,o.message)})},ae=()=>{q.value={global:{value:null,matchMode:Ce.CONTAINS}}},Q=()=>{let o=0,l=0,a=0;i.value.forEach(f=>{const k=f.quantity*f.price;switch(f.tax_config){case"TAX_EXCLUSIVE":o+=k;break;case"TAX_INCLUSIVE":l+=k;break;case"TAX_EXEMPTED":a+=k;break}});const n=.18*o,p=.18*l;z.value=n,$.value=p,T.value=n,B.value=B.value.map(f=>f.id===1?{...f,total:n+p,amount:o+(l-p)}:f.id===2?{...f,total:0,amount:a}:f)},v=c([]),X=c({id:1,name:"Cash"}),G=c(null),j=c(null),H=c(null),E=c(0),L=c(0),se=c([{id:1,name:"Cash"},{id:2,name:"Bank"},{id:3,name:"Credit"}]),R=()=>[{id:null,name:"",description:"",quantity:null,rate:null,amount:null,uuid:u.generateUUID()},{id:null,name:"",description:"",quantity:null,rate:null,amount:null,uuid:u.generateUUID()},{id:null,name:"",description:"",quantity:null,rate:null,amount:null,uuid:u.generateUUID()},{id:null,name:"",description:"",quantity:null,rate:null,amount:null,uuid:u.generateUUID()},{id:null,name:"",description:"",quantity:null,rate:null,amount:null,uuid:u.generateUUID()}],ne=c([{field:"name",header:"Product/Services"},{field:"description",header:"Description"},{field:"quantity",header:"Quantity"},{field:"rate",header:"Rate"},{field:"amount",header:"Amount"},{field:"tax",header:"Tax"}]),ie=o=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(o),K=o=>{let l=String(o);if(l=l.trim(),!l)return!1;l=l.replace(/^0+/,"")||"0";var a=Math.floor(Number(l));return a!==1/0&&String(a)===l&&a>=0},de=o=>{let{data:l,newValue:a,field:n}=o;switch(_e(),n){case"quantity":K(a)?(l[n]=a,l.amount=l[n]*l.rate):(o.preventDefault(),l[n]=1,l.amount=l[n]*l.rate);break;case"amount":case"rate":K(a)?l[n]=a:o.preventDefault();break;case"name":l[n]=a;default:a&&typeof a=="string"&&a.trim().length>0?l[n]=a:o.preventDefault();break}},ue=(o,l)=>{let a=v.value.findIndex(p=>p.uuid===o),n=v.value[a];console.log("---------------------------------------------------------"),console.log(l),n.name=l.name,n.id=l.id,n.description=l.description,n.quantity=1,n.rate=l.selling_price,n.amount=n.quantity*n.rate,v.value[a]=n},ce=o=>{o.index+1==v.value.length&&re()},re=()=>{v.value.push({id:null,name:"",description:"",quantity:null,rate:null,amount:null,uuid:u.generateUUID()})},me=()=>{v.value=R()},pe=()=>{v.value=v.value.concat(R())},_e=()=>{let o=0;v.value.forEach(l=>{o=o+l.quantity*l.rate}),E.value=o},ve=()=>{console.log("****************************************************************");let o=v.value.find(l=>l.id!=null);console.log(JSON.stringify(o))};return ye(()=>{ae()}),ge(()=>{Y(),oe(),v.value=R()}),(o,l)=>{var J;const a=C("Dropdown"),n=C("Button"),p=C("InputText"),f=C("Calendar"),k=C("InputNumber"),m=C("Column"),A=C("DataTable"),he=xe("tooltip");return x(),U("div",ke,[e("div",Ue,[e("div",De,[e("span",qe,[s(a,{id:"gauge",options:se.value,filter:"",modelValue:X.value,"onUpdate:modelValue":l[0]||(l[0]=t=>X.value=t),optionLabel:"name"},null,8,["options","modelValue"]),Te]),s(n,{onClick:l[1]||(l[1]=t=>o.toggleGaugeModal(!0)),icon:"pi pi-plus"})])]),e("div",Ne,[e("div",Ee,[e("span",Ae,[s(a,{id:"gauge",options:o.productGaugeList,filter:"",modelValue:j.value,"onUpdate:modelValue":l[2]||(l[2]=t=>j.value=t),optionLabel:"name"},null,8,["options","modelValue"]),Me]),s(n,{onClick:l[3]||(l[3]=t=>o.toggleGaugeModal(!0)),icon:"pi pi-plus"})])]),e("div",Pe,[e("span",Be,[s(p,{type:"text",id:"productId",modelValue:G.value,"onUpdate:modelValue":l[4]||(l[4]=t=>G.value=t)},null,8,["modelValue"]),Le])]),e("div",Re,[e("span",Oe,[s(f,{id:"date",modelValue:H.value,"onUpdate:modelValue":l[5]||(l[5]=t=>H.value=t)},null,8,["modelValue"]),$e])]),ze,Fe,Qe,e("div",Xe,[e("p",Ge,"Total: "+r(E.value),1)]),e("div",je,[e("div",He,[s(A,{value:v.value,stripedRows:"",showGridlines:"",editMode:"cell",onCellEditComplete:de,onCellEditInit:ce,pt:{table:{style:"min-width: 30rem"},column:{bodycell:({state:t})=>({class:[{"pt-0 pb-0":t.d_editing}]})}}},{default:d(()=>[(x(!0),U(we,null,Ve(ne.value,(t,V)=>(x(),M(m,{key:t.field,field:t.field,header:t.header,style:{width:"15%"}},{body:d(({data:b,field:h})=>[_(r(h==="price"?ie(b[h]):b[h]),1)]),editor:d(({data:b,field:h})=>[h=="name"?(x(),M(a,{key:0,id:"subCategory",change:"",options:P.value,filter:"",modelValue:b[h],"onUpdate:modelValue":I=>b[h]=I,optionLabel:"name",onChange:I=>ue(b.uuid,b.name)},null,8,["options","modelValue","onUpdate:modelValue","onChange"])):h==="description"?(x(),M(p,{key:1,modelValue:b[h],"onUpdate:modelValue":I=>b[h]=I,fluid:""},null,8,["modelValue","onUpdate:modelValue"])):(x(),M(k,{key:2,modelValue:b[h],"onUpdate:modelValue":I=>b[h]=I,fluid:""},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["field","header"]))),128))]),_:1},8,["value","pt"])])]),e("div",Ke,[s(n,{label:"Add",onClick:pe,icon:"pi pi-plus",iconPos:"left",class:"mr-2 mb-2"})]),e("div",Je,[s(n,{label:"Clear",onClick:me,icon:"pi pi-minus",iconPos:"left",class:"p-button-danger mr-2 mb-2"})]),We,Ye,e("div",Ze,[e("p",el,"Total: "+r(E.value),1)]),ll,e("div",tl,[e("span",ol,[s(p,{type:"text",id:"productId",modelValue:L.value,"onUpdate:modelValue":l[6]||(l[6]=t=>L.value=t),placeholder:"0"},null,8,["modelValue"]),al])]),e("div",sl,[e("p",nl,"Change: "+r(L.value-E.value),1)]),e("div",il,[s(n,{onClick:ve,label:"SUBMIT",class:"p-button-outlined mr-2 mb-2"})]),e("div",dl,[e("div",ul,[cl,rl,e("div",ml,[e("div",pl,[_l,s(A,{value:P.value,paginator:!0,size:"small",class:"p-datatable-gridlines",rows:50,dataKey:"id",filters:q.value,rowHover:!0,filterDisplay:"menu",responsiveLayout:"scroll"},{header:d(()=>[e("div",vl,[e("span",hl,[fl,s(p,{modelValue:q.value.global.value,"onUpdate:modelValue":l[7]||(l[7]=t=>q.value.global.value=t),placeholder:"Search..."},null,8,["modelValue"])])])]),default:d(()=>[s(m,{field:"name",header:"Product",style:{"min-width":"10rem"}},{body:d(({data:t})=>[_(r(t.name),1)]),_:1}),s(m,{field:"name",header:"Category",style:{"min-width":"10rem"}},{body:d(({data:t})=>[_(r(t.category_name),1)]),_:1}),s(m,{field:"name",header:"Price",style:{"max-width":"10rem"}},{body:d(({data:t})=>[_(r(w(u).commaSeparator(t.selling_price)),1)]),_:1}),s(m,{field:"name",header:"Quantity",style:{"max-width":"15rem"}},{body:d(({data:t})=>[_(r(t.quantity+" "+t.unit),1)]),_:1}),s(m,{header:"Manufacturer",style:{"min-width":"10rem"}},{body:d(({data:t})=>[_(r(t.manufacturer),1)]),_:1}),s(m,{header:"Date",style:{"min-width":"10rem"}},{body:d(({data:t})=>[_(r(t.created_at),1)]),_:1}),s(m,{headerStyle:"max-width:10rem;"},{body:d(({data:t})=>[Ie(s(n,{icon:"pi pi-check",class:"p-button-success mr-2",onClick:V=>Z(t)},null,8,["onClick"]),[[he,"Select product"]])]),_:1})]),_:1},8,["value","filters"])])])])]),e("div",bl,[e("div",yl,[gl,xl,e("div",Cl,[e("div",wl,[s(A,{value:i.value,size:"small",rows:20,dataKey:"id",rowHover:!0,filterDisplay:"menu",responsiveLayout:"scroll"},{default:d(()=>[s(m,{field:"name",header:"Name",style:{"max-width":"10rem"}},{body:d(({data:t})=>[_(r(t.name),1)]),_:1}),s(m,{field:"price",header:"Price",style:{"max-width":"10rem"}},{body:d(({data:t})=>[_(r(w(u).commaSeparator(t.price)),1)]),_:1}),s(m,{field:"quantity",header:"Qty",style:{"min-width":"10rem"}},{body:d(({data:t})=>[e("i",{class:"pi pi-minus",onClick:V=>F(t,"Subtract"),style:{"font-size":"1rem","margin-left":"3px",cursor:"pointer"}},null,8,Vl),s(p,{type:"text",onChange:V=>le(V,t),value:t.quantity,style:{width:"60px",padding:"5px","margin-left":"1px","margin-right":"1px","text-align":"center"},placeholder:"Qty"},null,8,["onChange","value"]),e("i",{class:"pi pi-plus",onClick:V=>F(t,"Add"),style:{"font-size":"1rem","margin-right":"3px",cursor:"pointer"}},null,8,Il)]),_:1}),s(m,{field:"subtotal",header:"Sub Total",style:{"max-width":"10rem"}},{body:d(({data:t})=>[_(r(w(u).commaSeparator(t.quantity*t.price)),1)]),_:1}),s(m,{headerStyle:"max-width:10rem;"},{body:d(({data:t})=>[s(n,{icon:"pi pi-trash",class:"p-button-rounded p-button-danger mr-2",onClick:V=>ee(t)},null,8,["onClick"])]),_:1})]),_:1},8,["value"])])])]),(J=S.value)!=null&&J.is_tax_enabled&&i.value.length>0?(x(),U("div",Sl,[kl,Ul,e("div",Dl,[e("div",ql,[s(A,{value:B.value,size:"small",rows:20,dataKey:"id",rowHover:!0,filterDisplay:"menu",responsiveLayout:"scroll"},{default:d(()=>[s(m,{field:"name",header:"18%",style:{"max-width":"10rem"}},{body:d(({data:t})=>[_(r(t.name),1)]),_:1}),s(m,{field:"price",header:"Amount",style:{"max-width":"10rem"}},{body:d(({data:t})=>[_(r(w(u).commaSeparator(t.amount)),1)]),_:1}),s(m,{field:"subtotal",header:"V.A.T",style:{"max-width":"10rem"}},{body:d(({data:t})=>[_(r(w(u).commaSeparator(t.total)),1)]),_:1})]),_:1},8,["value"])])])])):O("",!0),e("div",Tl,[Nl,El,e("div",Al,[Ml,e("div",Pl,[e("span",Bl,r(N(i.value)?w(u).commaSeparator(N(i.value)-Number(g.value)+Number(T.value)):0),1)]),Ll,e("div",Rl,[e("span",Ol,[s(p,{type:"text",id:"discount",modelValue:g.value,"onUpdate:modelValue":l[8]||(l[8]=t=>g.value=t)},null,8,["modelValue"]),$l])]),zl,e("div",Fl,[e("span",Ql,[s(p,{type:"text",id:"discount",modelValue:y.value,"onUpdate:modelValue":l[9]||(l[9]=t=>y.value=t)},null,8,["modelValue"]),Xl])]),Gl,e("div",jl,[y.value&&y.value>0?(x(),U("span",Hl,r(w(u).commaSeparator(Number(y.value)+Number(g.value)-N(i.value))),1)):O("",!0),!y.value||y.value==0?(x(),U("span",Kl,"0")):O("",!0)]),Jl,e("div",Wl,[s(n,{onClick:te,label:"SUBMIT",class:"p-button-outlined mr-2 mb-2"})])])])])])}}};export{et as default};
