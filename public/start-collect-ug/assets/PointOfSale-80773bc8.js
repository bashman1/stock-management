import{k as fe,l as be,r as i,x as ge,o as ye,b as y,c as _,d as k,e as t,h as u,t as x,f as w,i as p,g as f,y as xe,v as q,j as T,n as Ce,C as Ve}from"./index-3d982563.js";const we={class:"grid p-fluid"},Ne={class:"field col-12 md:col-3"},Ie={class:"p-float-label"},Se=t("label",{for:"paymentMethod"},"Payment methods",-1),Ue={class:"field col-12 md:col-3"},ke={class:"p-inputgroup"},qe={class:"p-float-label"},Te=t("label",{for:"Customer"},"Select customer",-1),De={class:"field col-12 md:col-3"},Ee={class:"p-float-label"},Ae=t("label",{for:"productId"},"Billing address",-1),Be={class:"field col-12 md:col-3"},Me={class:"p-float-label"},Re=t("label",{for:"date"},"Sales Date",-1),Le=t("div",{class:"col-12 md:col-3"},null,-1),Pe=t("div",{class:"col-12 md:col-3"},null,-1),Fe=t("div",{class:"col-12 md:col-3"},null,-1),ze={class:"col-12 md:col-3"},$e={class:"font-bold text-right text-6xl green-color"},Oe={class:"col-12 md:col-12"},Qe={class:"card"},Xe=["onClick"],He=["onClick"],Ke={class:"col-12 md:col-1"},je=t("div",{class:"col-12 md:col-1"},null,-1),Ge={class:"col-12 md:col-12"},Je={key:0,class:"card"},We=t("h5",null,"V.A.T 18%",-1),Ye=t("br",null,null,-1),Ze={class:"grid"},el={class:"field col-12 md:col-12"},ll=t("div",{class:"col-12 md:col-4"},null,-1),tl=t("div",{class:"col-12 md:col-3"},null,-1),ol={class:"col-12 md:col-3"},nl={class:"font-bold text-right text-xl green-color"},sl=t("div",{class:"col-12 md:col-3"},null,-1),al={class:"col-12 md:col-3"},il={class:"p-float-label"},ul=t("label",{for:"productId"},"Amount",-1),dl={class:"col-12 md:col-3"},rl={key:0,class:"font-bold text-left text-xl green-color"},cl={class:"col-12 md:col-3"},ml={style:{"padding-top":"20px"}},pl={class:"grid p-fluid"},vl={class:"field col-12 md:col-6"},_l={class:"p-float-label"},hl=t("label",{for:"supplierName"},"Name",-1),fl={class:"field col-12 md:col-6"},bl={class:"p-float-label"},gl=t("label",{for:"supplierEmail"},"Email",-1),yl={class:"field col-12 md:col-6"},xl={class:"p-float-label"},Cl=t("label",{for:"supplierAddress"},"Address",-1),Vl={class:"field col-12 md:col-6"},wl={class:"p-float-label"},Nl=t("label",{for:"supplierContact"},"Phone Number",-1),Il={class:"field col-12 md:col-12"},Sl={class:"p-float-label"},Ul=t("label",{for:"supplierDesc"},"More Info",-1),Tl={__name:"PointOfSale",setup(kl){const b=fe(),a=new Ve,W=be(),O=i(null),s=i([{id:null,price:null,quantity:null,discount:null,name:"",tax_config:null}]),g=i(0),h=i(0);i(0);const Y=i({}),N=i({}),I=i(0),Q=i(0),X=i(0),P=i(!1),D=i({}),C=i(null),E=i(null),A=i(null),B=i(null),M=i(null),H=i([]),F=i([{id:1,name:"18%",amount:0,total:0},{id:2,name:"Exempted",amount:0,total:0}]),Z=()=>{a.genericRequest("get-products","get",!0,{}).then(e=>{e.status?O.value=e.data:a.showError(b,e.message)})},ee=e=>{var c;let l={id:e.id,price:Number(e.selling_price),quantity:1,discount:0,name:e.name,tax_config:e.tax_config,units:[{id:1,ind:"Primary",name:e.unit,weight:1,price:Number(e.selling_price),unit_id:e==null?void 0:e.measurement_unit_id}],selected:{id:1,ind:"Primary",name:e.unit,weight:1,price:Number(e.selling_price),unit_id:e==null?void 0:e.measurement_unit_id}};e.secondary_unit&&l.units.push({id:2,ind:"Secondary",name:e.secondary_unit,weight:Number(e==null?void 0:e.secondary_weight),price:Number(e==null?void 0:e.secondary_price),unit_id:e==null?void 0:e.secondary_measurement_unit_id});const n=s.value.find(r=>r.id===l.id);if(n)n.quantity+=l.quantity;else{let r=s.value.length-1;s.value.splice(r,0,l)}(c=N==null?void 0:N.value)!=null&&c.is_tax_enabled&&R()},le=e=>{const l=s.value.findIndex(n=>n.id===e.id);l!==-1&&s.value.splice(l,1)},te=(e,l)=>{s.value=s.value.map(n=>n.id===l.id?{...n,quantity:Number(e.target.value)}:n)},oe=(e,l)=>{s.value=s.value.map(n=>n.id===l.id?{...n,price:Number(e.target.value)}:n),R()},K=(e,l)=>{s.value=s.value.map(n=>{if(n.id===e.id){if(l=="Add")return{...n,quantity:Number(n.quantity+1)};if(n.quantity>0)return{...n,quantity:Number(n.quantity-1)}}return n}),R()},V=e=>{let l=0;return e.length>0&&e.forEach(n=>{l+=n.quantity*n.price}),l},ne=()=>{var l;s.value=s==null?void 0:s.value.filter(n=>n.id!=null);let e={total:V(s==null?void 0:s.value)-Number(h==null?void 0:h.value)+Number(I.value),discount:Number(h==null?void 0:h.value),amountPaid:Number(g==null?void 0:g.value),itemCount:s==null?void 0:s.value.length,tranDate:$.value,items:s==null?void 0:s.value,status:"Active",vat:Number(I.value),vatInc:Q.value,vatEx:X.value,payment_method:S==null?void 0:S.value.value,address:L.value,customer_id:(l=U==null?void 0:U.value)==null?void 0:l.id};a.genericRequest("create-order","post",!0,e).then(n=>{n.status?(a.showSuccess(b,n.message),a.redirect(W,"/view-sales")):a.showError(b,n.message)})},se=()=>{a.genericRequest("get-institution-details","get",!0,{}).then(e=>{e.status?N.value=e.data:a.showError(b,e.message)})},ae=()=>{Y.value={global:{value:null,matchMode:xe.CONTAINS}}},R=()=>{let e=0,l=0,n=0;s.value.forEach(v=>{const m=v.quantity*v.price;switch(v.tax_config){case"TAX_EXCLUSIVE":e+=m;break;case"TAX_INCLUSIVE":l+=m;break;case"TAX_EXEMPTED":n+=m;break}});const c=.18*e,r=.18*l;X.value=c,Q.value=r,I.value=c,F.value=F.value.map(v=>v.id===1?{...v,total:c+r,amount:e+(l-r)}:v.id===2?{...v,total:0,amount:n}:v)},z=e=>{P.value=e},ie=(e,l)=>{D.value[l]=a.validateFormField(e)},ue=()=>{if(D.value.customerName=a.validateFormField(C.value),a.validateRequiredFields(D.value)){a.showError(b,"Please fill in the missing field");return}let l={name:C.value,address:A.value,email:E.value,phone_number:B.value,description:M.value,status:"Active"};a.genericRequest("create-customer","post",!0,l).then(n=>{n.status?(a.showSuccess(b,n.message),j(),z(!1),C.value=null,A.value=null,E.value=null,B.value=null,M.value=null):a.showError(b,n.message)})},j=()=>{a.genericRequest("get-customers","post",!0,{}).then(e=>{e.status?H.value=e.data:a.showError(b,e.message)})},de=e=>{e.value.address&&(L.value=e.value.address)},re=(e,l)=>{s.value=s.value.map(n=>n.id===l.id?{...n,price:Number(e.value.price)}:n),R()},ce=i([]),S=i({id:1,name:"Cash",value:"CASH"}),L=i(null),U=i(null),$=i(new Date);i(0),i(0);const me=i([{id:1,name:"Cash",value:"CASH"},{id:2,name:"Bank",value:"BANK"},{id:3,name:"Credit",value:"CREDIT"}]),pe=()=>[{id:null,name:"",description:"",quantity:null,rate:null,amount:null,uuid:a.generateUUID()},{id:null,name:"",description:"",quantity:null,rate:null,amount:null,uuid:a.generateUUID()},{id:null,name:"",description:"",quantity:null,rate:null,amount:null,uuid:a.generateUUID()},{id:null,name:"",description:"",quantity:null,rate:null,amount:null,uuid:a.generateUUID()},{id:null,name:"",description:"",quantity:null,rate:null,amount:null,uuid:a.generateUUID()}];i([{field:"name",header:"Product/Services"},{field:"description",header:"Description"},{field:"quantity",header:"Quantity"},{field:"rate",header:"Rate"},{field:"amount",header:"Amount"},{field:"tax",header:"Tax"}]);const ve=()=>{s.value=[{id:null,price:null,quantity:null,discount:null,name:"",tax_config:null}]};return ge(()=>{ae()}),ye(()=>{Z(),se(),j(),ce.value=pe()}),(e,l)=>{var J;const n=y("Dropdown"),c=y("Button"),r=y("InputText"),v=y("Calendar"),m=y("Column"),G=y("DataTable"),_e=y("Textarea"),he=y("Dialog");return _(),k("div",we,[t("div",Ne,[t("span",Ie,[u(n,{id:"paymentMethod",options:me.value,filter:"",modelValue:S.value,"onUpdate:modelValue":l[0]||(l[0]=o=>S.value=o),optionLabel:"name"},null,8,["options","modelValue"]),Se])]),t("div",Ue,[t("div",ke,[t("span",qe,[u(n,{id:"customer",onChange:de,options:H.value,filter:"",modelValue:U.value,"onUpdate:modelValue":l[1]||(l[1]=o=>U.value=o),optionLabel:"name"},null,8,["options","modelValue"]),Te]),u(c,{onClick:l[2]||(l[2]=o=>z(!0)),icon:"pi pi-plus"})])]),t("div",De,[t("span",Ee,[u(r,{type:"text",id:"productId",modelValue:L.value,"onUpdate:modelValue":l[3]||(l[3]=o=>L.value=o)},null,8,["modelValue"]),Ae])]),t("div",Be,[t("span",Me,[u(v,{id:"date",modelValue:$.value,"onUpdate:modelValue":l[4]||(l[4]=o=>$.value=o)},null,8,["modelValue"]),Re])]),Le,Pe,Fe,t("div",ze,[t("p",$e,"Total: "+x(V(s.value)?w(a).commaSeparator(V(s.value)-Number(h.value)+Number(I.value)):0),1)]),t("div",Oe,[t("div",Qe,[u(G,{value:s.value,size:"small",stripedRows:"",rows:20,dataKey:"id",rowHover:!0,filterDisplay:"menu",responsiveLayout:"scroll"},{default:p(()=>[u(m,{field:"name",header:"Name",style:{"max-width":"10rem"}},{body:p(({data:o})=>[o.id?f("",!0):(_(),q(n,{key:0,id:"subCategory",change:"",options:O.value,filter:"",optionLabel:"name",onChange:l[5]||(l[5]=d=>ee(d.value))},null,8,["options"])),T(" "+x(o.name),1)]),_:1}),u(m,{field:"quantity",header:"Qty",style:{"max-width":"8rem"}},{body:p(({data:o})=>[o.id?(_(),k("i",{key:0,class:"pi pi-minus",onClick:d=>K(o,"Subtract"),style:{"font-size":"1rem","margin-left":"3px",cursor:"pointer"}},null,8,Xe)):f("",!0),o.id?(_(),q(r,{key:1,type:"text",onChange:d=>te(d,o),value:o.quantity,style:{width:"100px",padding:"5px","margin-left":"1px","margin-right":"1px","text-align":"center"},placeholder:"Qty"},null,8,["onChange","value"])):f("",!0),o.id?(_(),k("i",{key:2,class:"pi pi-plus",onClick:d=>K(o,"Add"),style:{"font-size":"1rem","margin-right":"3px",cursor:"pointer"}},null,8,He)):f("",!0)]),_:1}),u(m,{field:"unit",header:"Unit",style:{"max-width":"8rem"}},{body:p(({data:o})=>[o.id?(_(),q(n,{key:0,id:"type",onChange:d=>re(d,o),filter:"",options:o.units,modelValue:o.selected,"onUpdate:modelValue":d=>o.selected=d,optionLabel:"name",style:{width:"80%","margin-left":"1px","margin-right":"1px"}},null,8,["onChange","options","modelValue","onUpdate:modelValue"])):f("",!0)]),_:1}),u(m,{field:"price",header:"Price",style:{"max-width":"8rem"}},{body:p(({data:o})=>[o.id?(_(),q(r,{key:0,type:"text",onChange:d=>oe(d,o),value:o.price,style:{width:"80%",padding:"5px","margin-left":"1px","margin-right":"1px","text-align":"center"},placeholder:"Qty"},null,8,["onChange","value"])):f("",!0)]),_:1}),u(m,{field:"subtotal",header:"Amount",style:{"max-width":"8rem"}},{body:p(({data:o})=>[T(x(o.id?w(a).commaSeparator(o.quantity*o.price):""),1)]),_:1}),u(m,{headerStyle:"width:6rem;"},{body:p(({data:o})=>[o.id?(_(),q(c,{key:0,icon:"pi pi-trash",class:"p-button-rounded p-button-danger mr-2",onClick:d=>le(o)},null,8,["onClick"])):f("",!0)]),_:1})]),_:1},8,["value"])])]),t("div",Ke,[u(c,{label:"Clear",onClick:ve,icon:"pi pi-minus",iconPos:"left",class:"p-button-danger mr-2 mb-2"})]),je,t("div",Ge,[(J=N.value)!=null&&J.is_tax_enabled&&s.value.length>0?(_(),k("div",Je,[We,Ye,t("div",Ze,[t("div",el,[u(G,{value:F.value,size:"small",rows:20,dataKey:"id",rowHover:!0,filterDisplay:"menu",responsiveLayout:"scroll"},{default:p(()=>[u(m,{field:"name",header:"18%",style:{"max-width":"10rem"}},{body:p(({data:o})=>[T(x(o.name),1)]),_:1}),u(m,{field:"price",header:"Amount",style:{"max-width":"10rem"}},{body:p(({data:o})=>[T(x(w(a).commaSeparator(o.amount)),1)]),_:1}),u(m,{field:"subtotal",header:"V.A.T",style:{"max-width":"10rem"}},{body:p(({data:o})=>[T(x(w(a).commaSeparator(o.total)),1)]),_:1})]),_:1},8,["value"])])])])):f("",!0)]),ll,tl,t("div",ol,[t("p",nl,"Total: "+x(V(s.value)?w(a).commaSeparator(V(s.value)-Number(h.value)+Number(I.value)):0),1)]),sl,t("div",al,[t("span",il,[u(r,{type:"text",id:"discount",modelValue:g.value,"onUpdate:modelValue":l[6]||(l[6]=o=>g.value=o)},null,8,["modelValue"]),ul])]),t("div",dl,[g.value&&g.value>0?(_(),k("p",rl,"Change: "+x(w(a).commaSeparator(Number(g.value)+Number(h.value)-V(s.value))),1)):f("",!0)]),t("div",cl,[u(c,{onClick:ne,label:"SUBMIT",class:"p-button-outlined mr-2 mb-2"})]),u(he,{header:"Create new customer",visible:P.value,"onUpdate:visible":l[14]||(l[14]=o=>P.value=o),style:{width:"75vw"},modal:!0,class:"p-fluid"},{footer:p(()=>[u(c,{label:"Cancel",onClick:l[13]||(l[13]=o=>z(!1)),icon:"pi pi-times",class:"p-button-outlined p-button-danger mr-2 mb-2"}),u(c,{onClick:ue,label:"SUBMIT",class:"p-button-outlined mr-2 mb-2"})]),default:p(()=>{var o;return[t("p",ml,[t("div",pl,[t("div",vl,[t("span",_l,[u(r,{type:"text",id:"customerName",onBlur:l[7]||(l[7]=d=>ie(C.value,"customerName")),modelValue:C.value,"onUpdate:modelValue":l[8]||(l[8]=d=>C.value=d),class:Ce({"p-invalid":(o=D.value)==null?void 0:o.customerName})},null,8,["modelValue","class"]),hl])]),t("div",fl,[t("span",bl,[u(r,{type:"text",id:"supplierEmail",modelValue:E.value,"onUpdate:modelValue":l[9]||(l[9]=d=>E.value=d)},null,8,["modelValue"]),gl])]),t("div",yl,[t("span",xl,[u(r,{type:"text",id:"supplierAddress",modelValue:A.value,"onUpdate:modelValue":l[10]||(l[10]=d=>A.value=d)},null,8,["modelValue"]),Cl])]),t("div",Vl,[t("span",wl,[u(r,{type:"text",id:"supplierContact",modelValue:B.value,"onUpdate:modelValue":l[11]||(l[11]=d=>B.value=d)},null,8,["modelValue"]),Nl])]),t("div",Il,[t("span",Sl,[u(_e,{inputId:"supplierDesc",rows:"7",modelValue:M.value,"onUpdate:modelValue":l[12]||(l[12]=d=>M.value=d)},null,8,["modelValue"]),Ul])])])])]}),_:1},8,["visible"])])}}};export{Tl as default};
