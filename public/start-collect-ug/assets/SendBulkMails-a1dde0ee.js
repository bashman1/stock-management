import{k as j,l as R,r as i,o as I,b as d,c as V,d as $,e as s,h as l,i as a,j as v,t as b,C as F}from"./index-54b662c4.js";const N={class:"card"},q={class:"text-end pb-4"},z={class:"grid p-fluid"},A={class:"field col-12 md:col-12"},Q={class:"grid p-fluid"},H={class:"field col-12 md:col-12 mt-10"},K={class:"p-float-label"},L={class:"field col-12 md:col-12"},G={__name:"SendBulkMails",setup(O){const m=j(),n=new F;R();const f=i(null),k=i(null),w=i(!1),y=i(!1),c=i([]),p=i(null),g=i(null),S=o=>{f.value=o.target.files[0]},h=o=>{w.value=o},_=o=>{y.value=o},T=async()=>{if(!f.value)return;const o=new FormData;o.append("file",f.value),o.append("name",f.value.name);try{const e=await fetch(n.baseUrl+"upload-mail-receivers",{method:"POST",body:o,headers:{Authorization:`Bearer ${n.getStorage().token}`}});if(!e.ok)throw new Error("Upload failed");const C=await e.json();n.showSuccess(m,C.message),h(!1),x()}catch(e){console.error(e.message),n.showError(m,e.message)}},x=()=>{n.genericRequest("get-mailReceivers","get",!0,{}).then(o=>{o.status?k.value=o.data:n.showError(m,o.message)})},U=()=>{let o={subject:g.value,body:p.value,receivers:c.value};n.genericRequest("send-bulk-mails","post",!0,o).then(e=>{e.status?(n.showSuccess(m,p.message),_(!1),g.value=null,p.value=null):n.showError(m,e.message)})};return I(()=>{x()}),(o,e)=>{const C=d("Toast"),r=d("Button"),u=d("Column"),D=d("DataTable"),M=d("Dialog"),E=d("InputText"),B=d("QuillEditor");return V(),$("div",N,[e[12]||(e[12]=s("h5",null,"Bulk Email Receiver",-1)),l(C),l(D,{value:k.value,paginator:!0,class:"p-datatable-gridlines",rows:10,dataKey:"id",rowHover:!0,filterDisplay:"menu",responsiveLayout:"scroll",selection:c.value,"onUpdate:selection":e[2]||(e[2]=t=>c.value=t)},{header:a(()=>[s("div",q,[l(r,{icon:"pi pi-upload",label:"Upload email address",onClick:e[0]||(e[0]=t=>h(!0)),class:"mr-2"}),l(r,{icon:"pi pi-inbox",label:"Compose Message",onClick:e[1]||(e[1]=t=>_(!0)),class:"mr-2",disabled:!c.value||!c.value.length},null,8,["disabled"])])]),default:a(()=>[l(u,{field:"name",header:"Name",style:{"min-width":"10rem"}},{body:a(({data:t})=>[v(b(t.name),1)]),_:1}),l(u,{header:"Email",style:{"min-width":"10rem"}},{body:a(({data:t})=>[v(b(t.email),1)]),_:1}),l(u,{header:"Category",style:{"min-width":"12rem"}},{body:a(({data:t})=>[v(b(t.category),1)]),_:1}),l(u,{header:"Institution",style:{"min-width":"10rem"}},{body:a(({data:t})=>[v(b(t.institution_name),1)]),_:1}),l(u,{header:"Date",style:{"min-width":"10rem"}},{body:a(({data:t})=>[v(b(t.created_at),1)]),_:1}),l(u,{selectionMode:"multiple",headerStyle:"width: 3rem"})]),_:1},8,["value","selection"]),l(M,{header:"Upload Email Address",visible:w.value,"onUpdate:visible":e[5]||(e[5]=t=>w.value=t),style:{width:"30vw"},modal:!0,class:"p-fluid"},{footer:a(()=>[l(r,{label:"Cancel",onClick:e[4]||(e[4]=t=>h(!1)),icon:"pi pi-times",class:"p-button-outlined p-button-danger mr-2 mb-2"}),l(r,{onClick:T,label:"SUBMIT",class:"p-button-outlined mr-2 mb-2"})]),default:a(()=>[s("div",z,[e[10]||(e[10]=s("a",{href:"demo/documents/Mail_Receivers.xlsx"},[s("i",{class:"pi pi-cloud-download",style:{"font-size":"2rem"}}),s("p",null,"Download template")],-1)),s("div",A,[s("input",{type:"file",accept:".xlsx, .xls",onChange:e[3]||(e[3]=t=>S(t))},null,32)])])]),_:1},8,["visible"]),l(M,{header:"Create Message",visible:y.value,"onUpdate:visible":e[9]||(e[9]=t=>y.value=t),style:{width:"90vw"},modal:!0,class:"p-fluid"},{footer:a(()=>[l(r,{label:"Cancel",onClick:e[8]||(e[8]=t=>_(!1)),icon:"pi pi-times",class:"p-button-outlined p-button-danger mr-2 mb-2"}),l(r,{onClick:U,label:"SUBMIT",class:"p-button-outlined mr-2 mb-2"})]),default:a(()=>[s("div",Q,[s("div",H,[s("span",K,[l(E,{type:"text",id:"subject",modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=t=>g.value=t)},null,8,["modelValue"]),e[11]||(e[11]=s("label",{for:"subject"},"Subject",-1))])]),s("div",L,[l(B,{content:p.value,"onUpdate:content":e[7]||(e[7]=t=>p.value=t),contentType:"html",toolbar:"full",theme:"snow"},null,8,["content"])])])]),_:1},8,["visible"])])}}};export{G as default};
