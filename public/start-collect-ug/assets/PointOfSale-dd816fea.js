import{k as _e,l as fe,r as n,x as he,o as ge,b as h,c as g,d as A,e as l,h as u,t as I,f as B,i as b,g as y,y as be,v as M,j as K,n as ye,C as xe}from"./index-84d51397.js";const Ce={class:"grid p-fluid"},Ve={class:"field col-12 md:col-3"},Ne={class:"p-float-label"},we=l("label",{for:"paymentMethod"},"Payment methods",-1),Ie={class:"field col-12 md:col-3"},qe={class:"p-inputgroup"},Se={class:"p-float-label"},Te=l("label",{for:"Customer"},"Select customer",-1),ke={class:"field col-12 md:col-3"},De={class:"p-float-label"},Ee=l("label",{for:"productId"},"Billing address",-1),Ue={class:"field col-12 md:col-3"},Ae={class:"p-float-label"},Be=l("label",{for:"date"},"Sales Date",-1),Me=l("div",{class:"col-12 md:col-3"},null,-1),Re=l("div",{class:"col-12 md:col-3"},null,-1),Fe=l("div",{class:"col-12 md:col-3"},null,-1),Le={class:"col-12 md:col-3"},Pe={class:"font-bold text-right text-6xl green-color"},Oe={class:"col-12 md:col-12"},$e={class:"card"},ze=["onClick"],Qe=["onClick"],Xe={class:"col-12 md:col-1"},He=l("div",{class:"col-12 md:col-1"},null,-1),je=l("div",{class:"col-12 md:col-4"},null,-1),Ke=l("div",{class:"col-12 md:col-3"},null,-1),Je={class:"col-12 md:col-3"},Ge={class:"font-bold text-right text-xl green-color"},We=l("div",{class:"col-12 md:col-3"},null,-1),Ye={class:"col-12 md:col-3"},Ze={class:"p-float-label"},el=l("label",{for:"productId"},"Amount",-1),ll={class:"col-12 md:col-3"},tl={key:0,class:"font-bold text-left text-xl green-color"},ol={class:"col-12 md:col-3"},al={style:{"padding-top":"20px"}},sl={class:"grid p-fluid"},nl={class:"field col-12 md:col-6"},il={class:"p-float-label"},ul=l("label",{for:"supplierName"},"Name",-1),dl={class:"field col-12 md:col-6"},rl={class:"p-float-label"},cl=l("label",{for:"supplierEmail"},"Email",-1),ml={class:"field col-12 md:col-6"},vl={class:"p-float-label"},pl=l("label",{for:"supplierAddress"},"Address",-1),_l={class:"field col-12 md:col-6"},fl={class:"p-float-label"},hl=l("label",{for:"supplierContact"},"Phone Number",-1),gl={class:"field col-12 md:col-12"},bl={class:"p-float-label"},yl=l("label",{for:"supplierDesc"},"More Info",-1),Vl={__name:"PointOfSale",setup(xl){const _=_e(),i=new xe,J=fe(),P=n(null),s=n([{id:null,price:null,quantity:null,discount:null,name:"",tax_config:null}]),f=n(0),v=n(0);n(0);const G=n({}),q=n({}),V=n(0),O=n(0),$=n(0),R=n(!1),S=n({}),x=n(null),T=n(null),k=n(null),D=n(null),E=n(null),z=n([]),Q=n([{id:1,name:"18%",amount:0,total:0},{id:2,name:"Exempted",amount:0,total:0}]),W=()=>{i.genericRequest("get-products","get",!0,{}).then(t=>{t.status?P.value=t.data:i.showError(_,t.message)})},Y=t=>{var c;console.log(JSON.stringify(t));let e={id:t.id,price:t.selling_price,quantity:1,discount:0,name:t.name,tax_config:t.tax_config};const o=s.value.find(r=>r.id===e.id);if(o)o.quantity+=e.quantity;else{let r=s.value.length-1;s.value.splice(r,0,e)}(c=q==null?void 0:q.value)!=null&&c.is_tax_enabled&&H()},Z=t=>{const e=s.value.findIndex(o=>o.id===t.id);e!==-1&&s.value.splice(e,1)},ee=(t,e)=>{s.value=s.value.map(o=>o.id===e.id?{...o,quantity:Number(t.target.value)}:o)},le=(t,e)=>{s.value=s.value.map(o=>o.id===e.id?{...o,price:Number(t.target.value)}:o)},X=(t,e)=>{s.value=s.value.map(o=>{if(o.id===t.id){if(e=="Add")return{...o,quantity:Number(o.quantity+1)};if(o.quantity>0)return{...o,quantity:Number(o.quantity-1)}}return o}),H()},C=t=>{let e=0;return t.length>0&&t.forEach(o=>{e+=o.quantity*o.price}),e},te=()=>{var e;s.value=s==null?void 0:s.value.filter(o=>o.id!=null);let t={total:C(s==null?void 0:s.value)-Number(v==null?void 0:v.value)+Number(V.value),discount:Number(v==null?void 0:v.value),amountPaid:Number(f==null?void 0:f.value),itemCount:s==null?void 0:s.value.length,tranDate:L.value,items:s==null?void 0:s.value,status:"Active",vat:Number(V.value),vatInc:O.value,vatEx:$.value,payment_method:N==null?void 0:N.value.value,address:U.value,customer_id:(e=w==null?void 0:w.value)==null?void 0:e.id};i.genericRequest("create-order","post",!0,t).then(o=>{o.status?(i.showSuccess(_,o.message),i.redirect(J,"/view-sales")):i.showError(_,o.message)})},oe=()=>{i.genericRequest("get-institution-details","get",!0,{}).then(t=>{t.status?q.value=t.data:i.showError(_,t.message)})},ae=()=>{G.value={global:{value:null,matchMode:be.CONTAINS}}},H=()=>{let t=0,e=0,o=0;s.value.forEach(m=>{const p=m.quantity*m.price;switch(m.tax_config){case"TAX_EXCLUSIVE":t+=p;break;case"TAX_INCLUSIVE":e+=p;break;case"TAX_EXEMPTED":o+=p;break}});const c=.18*t,r=.18*e;$.value=c,O.value=r,V.value=c,Q.value=Q.value.map(m=>m.id===1?{...m,total:c+r,amount:t+(e-r)}:m.id===2?{...m,total:0,amount:o}:m)},F=t=>{R.value=t},se=(t,e)=>{S.value[e]=i.validateFormField(t)},ne=()=>{if(S.value.customerName=i.validateFormField(x.value),i.validateRequiredFields(S.value)){i.showError(_,"Please fill in the missing field");return}let e={name:x.value,address:k.value,email:T.value,phone_number:D.value,description:E.value,status:"Active"};i.genericRequest("create-customer","post",!0,e).then(o=>{o.status?(i.showSuccess(_,o.message),j(),F(!1),x.value=null,k.value=null,T.value=null,D.value=null,E.value=null):i.showError(_,o.message)})},j=()=>{i.genericRequest("get-customers","post",!0,{}).then(t=>{t.status?z.value=t.data:i.showError(_,t.message)})},ie=t=>{t.value.address&&(U.value=t.value.address)},ue=n([]),N=n({id:1,name:"Cash",value:"CASH"}),U=n(null),w=n(null),L=n(new Date);n(0),n(0);const de=n([{id:1,name:"Cash",value:"CASH"},{id:2,name:"Bank",value:"BANK"},{id:3,name:"Credit",value:"CREDIT"}]),re=()=>[{id:null,name:"",description:"",quantity:null,rate:null,amount:null,uuid:i.generateUUID()},{id:null,name:"",description:"",quantity:null,rate:null,amount:null,uuid:i.generateUUID()},{id:null,name:"",description:"",quantity:null,rate:null,amount:null,uuid:i.generateUUID()},{id:null,name:"",description:"",quantity:null,rate:null,amount:null,uuid:i.generateUUID()},{id:null,name:"",description:"",quantity:null,rate:null,amount:null,uuid:i.generateUUID()}];n([{field:"name",header:"Product/Services"},{field:"description",header:"Description"},{field:"quantity",header:"Quantity"},{field:"rate",header:"Rate"},{field:"amount",header:"Amount"},{field:"tax",header:"Tax"}]);const ce=()=>{s.value=[{id:null,price:null,quantity:null,discount:null,name:"",tax_config:null}]};return he(()=>{ae()}),ge(()=>{W(),oe(),j(),ue.value=re()}),(t,e)=>{const o=h("Dropdown"),c=h("Button"),r=h("InputText"),m=h("Calendar"),p=h("Column"),me=h("DataTable"),ve=h("Textarea"),pe=h("Dialog");return g(),A("div",Ce,[l("div",Ve,[l("span",Ne,[u(o,{id:"paymentMethod",options:de.value,filter:"",modelValue:N.value,"onUpdate:modelValue":e[0]||(e[0]=a=>N.value=a),optionLabel:"name"},null,8,["options","modelValue"]),we])]),l("div",Ie,[l("div",qe,[l("span",Se,[u(o,{id:"customer",onChange:ie,options:z.value,filter:"",modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=a=>w.value=a),optionLabel:"name"},null,8,["options","modelValue"]),Te]),u(c,{onClick:e[2]||(e[2]=a=>F(!0)),icon:"pi pi-plus"})])]),l("div",ke,[l("span",De,[u(r,{type:"text",id:"productId",modelValue:U.value,"onUpdate:modelValue":e[3]||(e[3]=a=>U.value=a)},null,8,["modelValue"]),Ee])]),l("div",Ue,[l("span",Ae,[u(m,{id:"date",modelValue:L.value,"onUpdate:modelValue":e[4]||(e[4]=a=>L.value=a)},null,8,["modelValue"]),Be])]),Me,Re,Fe,l("div",Le,[l("p",Pe,"Total: "+I(C(s.value)?B(i).commaSeparator(C(s.value)-Number(v.value)+Number(V.value)):0),1)]),l("div",Oe,[l("div",$e,[u(me,{value:s.value,size:"small",stripedRows:"",rows:20,dataKey:"id",rowHover:!0,filterDisplay:"menu",responsiveLayout:"scroll"},{default:b(()=>[u(p,{field:"name",header:"Name",style:{"max-width":"10rem"}},{body:b(({data:a})=>[a.id?y("",!0):(g(),M(o,{key:0,id:"subCategory",change:"",options:P.value,filter:"",optionLabel:"name",onChange:e[5]||(e[5]=d=>Y(d.value))},null,8,["options"])),K(" "+I(a.name),1)]),_:1}),u(p,{field:"quantity",header:"Qty",style:{"min-width":"10rem"}},{body:b(({data:a})=>[a.id?(g(),A("i",{key:0,class:"pi pi-minus",onClick:d=>X(a,"Subtract"),style:{"font-size":"1rem","margin-left":"3px",cursor:"pointer"}},null,8,ze)):y("",!0),a.id?(g(),M(r,{key:1,type:"text",onChange:d=>ee(d,a),value:a.quantity,style:{width:"100px",padding:"5px","margin-left":"1px","margin-right":"1px","text-align":"center"},placeholder:"Qty"},null,8,["onChange","value"])):y("",!0),a.id?(g(),A("i",{key:2,class:"pi pi-plus",onClick:d=>X(a,"Add"),style:{"font-size":"1rem","margin-right":"3px",cursor:"pointer"}},null,8,Qe)):y("",!0)]),_:1}),u(p,{field:"price",header:"Price",style:{"max-width":"10rem"}},{body:b(({data:a})=>[a.id?(g(),M(r,{key:0,type:"text",onChange:d=>le(d,a),value:a.price,style:{width:"80%",padding:"5px","margin-left":"1px","margin-right":"1px","text-align":"center"},placeholder:"Qty"},null,8,["onChange","value"])):y("",!0)]),_:1}),u(p,{field:"subtotal",header:"Sub Total",style:{"max-width":"10rem"}},{body:b(({data:a})=>[K(I(a.id?B(i).commaSeparator(a.quantity*a.price):""),1)]),_:1}),u(p,{headerStyle:"max-width:10rem;"},{body:b(({data:a})=>[a.id?(g(),M(c,{key:0,icon:"pi pi-trash",class:"p-button-rounded p-button-danger mr-2",onClick:d=>Z(a)},null,8,["onClick"])):y("",!0)]),_:1})]),_:1},8,["value"])])]),l("div",Xe,[u(c,{label:"Clear",onClick:ce,icon:"pi pi-minus",iconPos:"left",class:"p-button-danger mr-2 mb-2"})]),He,je,Ke,l("div",Je,[l("p",Ge,"Total: "+I(C(s.value)?B(i).commaSeparator(C(s.value)-Number(v.value)+Number(V.value)):0),1)]),We,l("div",Ye,[l("span",Ze,[u(r,{type:"text",id:"discount",modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=a=>f.value=a)},null,8,["modelValue"]),el])]),l("div",ll,[f.value&&f.value>0?(g(),A("p",tl,"Change: "+I(B(i).commaSeparator(Number(f.value)+Number(v.value)-C(s.value))),1)):y("",!0)]),l("div",ol,[u(c,{onClick:te,label:"SUBMIT",class:"p-button-outlined mr-2 mb-2"})]),u(pe,{header:"Create new customer",visible:R.value,"onUpdate:visible":e[14]||(e[14]=a=>R.value=a),style:{width:"75vw"},modal:!0,class:"p-fluid"},{footer:b(()=>[u(c,{label:"Cancel",onClick:e[13]||(e[13]=a=>F(!1)),icon:"pi pi-times",class:"p-button-outlined p-button-danger mr-2 mb-2"}),u(c,{onClick:ne,label:"SUBMIT",class:"p-button-outlined mr-2 mb-2"})]),default:b(()=>{var a;return[l("p",al,[l("div",sl,[l("div",nl,[l("span",il,[u(r,{type:"text",id:"customerName",onBlur:e[7]||(e[7]=d=>se(x.value,"customerName")),modelValue:x.value,"onUpdate:modelValue":e[8]||(e[8]=d=>x.value=d),class:ye({"p-invalid":(a=S.value)==null?void 0:a.customerName})},null,8,["modelValue","class"]),ul])]),l("div",dl,[l("span",rl,[u(r,{type:"text",id:"supplierEmail",modelValue:T.value,"onUpdate:modelValue":e[9]||(e[9]=d=>T.value=d)},null,8,["modelValue"]),cl])]),l("div",ml,[l("span",vl,[u(r,{type:"text",id:"supplierAddress",modelValue:k.value,"onUpdate:modelValue":e[10]||(e[10]=d=>k.value=d)},null,8,["modelValue"]),pl])]),l("div",_l,[l("span",fl,[u(r,{type:"text",id:"supplierContact",modelValue:D.value,"onUpdate:modelValue":e[11]||(e[11]=d=>D.value=d)},null,8,["modelValue"]),hl])]),l("div",gl,[l("span",bl,[u(ve,{inputId:"supplierDesc",rows:"7",modelValue:E.value,"onUpdate:modelValue":e[12]||(e[12]=d=>E.value=d)},null,8,["modelValue"]),yl])])])])]}),_:1},8,["visible"])])}}};export{Vl as default};
